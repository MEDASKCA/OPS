<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Request access   MEDASKCA</title>
  <meta name="color-scheme" content="dark light"/>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}

    :root{
      --bg1:#0b0f14; --bg2:#0b1220; --card:#0f1720; --line:#162235;
      --text:#e6ecf5; --muted:#9fb3c8; --brand1:#27a4ff; --brand2:#5c7cff;
      --input:#0b1220; --shadow:0 10px 28px rgba(0,0,0,.25);
      --radius:14px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg1:#f3f6fb; --bg2:#eef3fb; --card:#ffffff; --line:#e5e7eb;
        --text:#0a2540; --muted:#56637a; --brand1:#0a66ff; --brand2:#6285ff;
        --input:#f7fbff; --shadow:0 10px 26px rgba(10,37,64,.08);
      }
    }

    body{
      margin:0; font-family:"Manrope", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 650px at 10% 10%, rgba(39,164,255,.10), transparent 60%),
        radial-gradient(800px 500px at 90% 30%, rgba(92,124,255,.10), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      line-height:1.5;
    }

    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{
      width:100%;max-width:880px;background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;
    }

    .head{
      padding:16px 18px;border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,var(--bg2),var(--card));
    }
    .brandline{display:flex; align-items:center; gap:10px; margin:0 0 6px;}
    .brandline img{height:26px;width:auto;display:block}
    .brand{font-weight:600;letter-spacing:.2px}
    .title{font-size:20px;margin:2px 0 0;font-weight:600}
    .lead{margin:6px 0 0;color:var(--muted);font-size:14px}

    .content{padding:18px}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(260px,1fr));
      gap:14px;
    }

    label{font-size:13px;color:var(--muted);margin:2px 0 6px;display:block;font-weight:500}

    /* ---------- Unified control styling (fixes misalignment) ---------- */
    input,select,textarea{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:var(--input);
      color:var(--text);
      outline:none;
      transition:border-color .15s, box-shadow .15s;
      font-weight:400;
      font-size:14px;
      min-height:44px;                 /* same height for inputs & selects */
    }
    input::placeholder, textarea::placeholder{color:#95a8bf}
    input:focus,select:focus,textarea:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.15)}

    /* Custom arrow for select without changing height */
    select{
      -webkit-appearance:none; appearance:none;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7l5 6 5-6' stroke='%239fb3c8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 12px center;
      background-size:14px;
      padding-right:38px;
    }

    textarea{min-height:112px;resize:vertical}

    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    .actions{display:flex;gap:10px;align-items:center;margin-top:6px}
    button{
      appearance:none;border:0;padding:11px 16px;border-radius:12px;font-weight:600;
      color:#fff;background:linear-gradient(135deg,var(--brand1),var(--brand2));
      cursor:pointer;box-shadow:0 10px 24px rgba(39,164,255,.22)
    }
    button[disabled]{opacity:.6;cursor:wait}
    .ghost{background:transparent;color:var(--text);border:1px solid var(--line)}

    .note,.error,.ok{
      margin-top:12px;padding:12px 14px;border-radius:12px;border:1px solid var(--line);font-size:14px;background:var(--input)
    }
    .ok{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.08)}
    .error{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.08)}

    .foot{border-top:1px solid var(--line);padding:12px 18px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .foot a{color:inherit}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="brandline">
          <img src="/logo-medaskca.png" alt="MEDASKCA logo">
          <div class="brand">MEDASKCA</div>
        </div>
        <h1 class="title">Request access</h1>
        <p class="lead">Tell us who you are. We’ll review and send a secure sign-in link once approved.</p>
      </div>

      <div class="content">
        <form id="accessForm" class="grid" novalidate>
          <!-- honeypot for bots -->
          <input type="text" name="website" tabindex="-1" autocomplete="off" aria-hidden="true" style="position:absolute;left:-10000px;opacity:0;height:0;width:0"/>

          <div>
            <label for="title">Title</label>
            <select id="title" name="title">
              <option value=""> </option>
              <option>Dr</option><option>Mr</option><option>Ms</option><option>Mx</option><option>Prof</option><option>Other</option>
            </select>
          </div>

          <div>
            <label for="first">First name *</label>
            <input id="first" name="first_name" autocomplete="given-name" required>
          </div>

          <div>
            <label for="last">Last name *</label>
            <input id="last" name="last_name" autocomplete="family-name" required>
          </div>

          <div>
            <label for="email">Work email *</label>
            <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required>
            <div class="hint">Use your organisational email (no personal providers).</div>
          </div>

          <div>
            <label for="org">Organisation *</label>
            <input id="org" name="organisation" autocomplete="organization" required>
          </div>

          <div>
            <label for="role">Role / Job title</label>
            <input id="role" name="role" autocomplete="organization-title">
          </div>

          <div>
            <label for="country">Country / Region</label>
            <input id="country" name="country" autocomplete="country-name">
          </div>

          <div style="grid-column:1 / -1">
            <label for="intent">Intended use (what do you need access for?)</label>
            <textarea id="intent" name="intended_use" placeholder="Brief context helps us route your request."></textarea>
          </div>

          <!-- Referral -->
          <div>
            <label for="ref">How did you hear about us? (optional)</label>
            <select id="ref" name="referral">
              <option value=""> </option>
              <option>Colleague referral</option>
              <option>Conference / event</option>
              <option>Search engine (Google/Bing)</option>
              <option>LinkedIn</option>
              <option>X / Twitter</option>
              <option>Academic paper / journal</option>
              <option>NHS / Trust internal comms</option>
              <option>Vendor / partner</option>
              <option>Newsletter / email</option>
              <option>Other</option>
            </select>
          </div>

          <div id="refOtherWrap" style="display:none">
            <label for="ref_other">Please specify</label>
            <input id="ref_other" name="referral_other" placeholder="Tell us where you heard about MEDASKCA">
          </div>
          <!-- /Referral -->

          <div class="actions" style="grid-column:1 / -1">
            <button id="submitBtn" type="submit">Request access</button>
            <button type="button" class="ghost" onclick="location.href='/'">Back to home</button>
          </div>

          <div id="msg" class="note" style="display:none;grid-column:1 / -1"></div>
        </form>
      </div>

      <div class="foot">
        <span>Questions? <a href="mailto:registrations@medaskca.com">registrations@medaskca.com</a></span>
        <span>© <span id="year"></span> MEDASKCA</span>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('accessForm');
    const msg  = document.getElementById('msg');
    const btn  = document.getElementById('submitBtn');

    // Referral "Other" toggle
    const ref = document.getElementById('ref');
    const refOtherWrap = document.getElementById('refOtherWrap');
    const refOther = document.getElementById('ref_other');
    ref.addEventListener('change', () => {
      const show = ref.value === 'Other';
      refOtherWrap.style.display = show ? '' : 'none';
      if (!show) refOther.value = '';
    });

    function show(type, text){
      msg.className = type === 'ok' ? 'ok' : (type === 'error' ? 'error' : 'note');
      msg.textContent = text;
      msg.style.display = 'block';
      msg.scrollIntoView({behavior:'smooth', block:'center'});
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.style.display = 'none';
      if (form.website.value) return; // bot

      const required = ['first_name','last_name','email','organisation'];
      for (const id of required){
        const el = form.querySelector('[name="'+id+'"]');
        if (!el.value.trim()){
          el.focus(); show('error','Please fill in all required fields.'); return;
        }
      }

      btn.disabled = true;

      const title = (form.title.value || '').trim();
      const first = form.first_name.value.trim();
      const last  = form.last_name.value.trim();
      const email = form.email.value.trim().toLowerCase();
      const organisation = form.organisation.value.trim();
      const role  = (form.role.value || '').trim();
      const intended_use = (form.intended_use.value || '').trim();
      const country = (form.country.value || '').trim();
      const referral = (form.referral.value || '').trim();
      const referral_other = (form.referral_other?.value || '').trim();

      const fullName = [title, first, last].filter(Boolean).join(' ').trim();
      const referralDisplay = referral === 'Other' && referral_other ? `Other - ${referral_other}` : referral;

      const notes = [
        role ? `Role: ${role}` : null,
        intended_use ? `Intended use: ${intended_use}` : null,
        country ? `Country: ${country}` : null,
        referralDisplay ? `Referral: ${referralDisplay}` : null
      ].filter(Boolean).join(' | ');

      const payload = {
        title, first_name:first, last_name:last, email, organisation, role, intended_use, country,
        referral, referral_other,
        name: fullName,
        notes
      };

      try{
        const res = await fetch('/api/register', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });

        if(!res.ok){
          const t = await res.text().catch(()=> '');
          show('error','Something went wrong. Please try again.' + (t ? ` (${t.slice(0,140)})` : ''));
          btn.disabled = false; return;
        }
        show('ok','Thanks! Your request has been received. We’ll email you when it’s approved.');
        form.reset();
        refOtherWrap.style.display = 'none';
      }catch(err){
        show('error','Network error. Please try again.');
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
